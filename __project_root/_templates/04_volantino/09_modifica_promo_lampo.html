{% extends "01_base.html" %}
{% block content %}

<div class="container mt-5">
  <h2 class="fw-bold mb-4">⚡ Modifica Promo Lampo</h2>

  <form method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm rounded-4">
    <!-- Nome -->
    <div class="mb-3">
      <label for="nome" class="form-label">📝 Nome Prodotto</label>
      <textarea id="nome" name="nome" class="form-control" rows="3" required>{{ promo['nome'] }}</textarea>
    </div>

    <!-- Immagine prodotto -->
    <div class="mb-3">
      <label for="immagine" class="form-label">🖼 Immagine Prodotto</label>
      <div class="mb-2">
        <img id="preview-immagine" 
             src="{{ url_for('static', filename='uploads/promolampo/' ~ promo['immagine']) if promo['immagine'] else url_for('static', filename='no-image.png') }}" 
             alt="Anteprima Immagine" class="img-thumbnail" style="max-height:150px;">
      </div>
      <input type="file" id="immagine" name="immagine" class="form-control" accept="image/*" onchange="previewImage(this, 'preview-immagine')">
      <div class="form-text">Lascia vuoto se non vuoi cambiare l'immagine.</div>
    </div>

    <!-- Sfondo volantino -->
    <div class="mb-3">
      <label for="sfondo" class="form-label">🌄 Sfondo Volantino</label>
      <div class="mb-2">
        <img id="preview-sfondo" 
             src="{{ url_for('static', filename='uploads/promolampo/' ~ promo['sfondo']) if promo['sfondo'] else url_for('static', filename='no-image.png') }}" 
             alt="Anteprima Sfondo" class="img-thumbnail" style="max-height:150px;">
      </div>
      <input type="file" id="sfondo" name="sfondo" class="form-control" accept="image/*" onchange="previewImage(this, 'preview-sfondo')">
      <div class="form-text">Lascia vuoto se non vuoi cambiare lo sfondo.</div>
    </div>

    <!-- Pulsanti -->
    <div class="d-flex gap-2 mb-3">
      <button type="submit" class="btn btn-success">💾 Salva Modifiche</button>
      <a href="{{ url_for('lista_volantini_completa') }}" class="btn btn-secondary">↩ Torna Indietro</a>
    </div>

    <!-- Pulsante Apri Editor -->
    <div class="mb-3">
      <a href="{{ url_for('editor_promo_lampo', promo_id=promo['id']) }}" 
         class="btn btn-primary btn-lg w-100">
         🖌 Apri Editor Visuale
      </a>
    </div>
  </form>
</div>

<script>
function previewImage(input, previewId) {
  const preview = document.getElementById(previewId);
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
    }
    reader.readAsDataURL(input.files[0]);
  } else {
    preview.src = "{{ url_for('static', filename='no-image.png') }}";
  }
}
</script>

{% endblock %}
