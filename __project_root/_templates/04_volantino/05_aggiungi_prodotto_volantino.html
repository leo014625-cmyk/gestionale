{% extends "01_base.html" %}
{% block content %}

<div class="container mt-5">
    <div class="card shadow-sm rounded-4 p-4">
        <h2 class="mb-4">âž• Aggiungi Prodotto al Volantino: 
            <span class="text-primary">{{ volantino['titolo'] }}</span>
        </h2>

        <div class="row g-4">
            <!-- FORM INPUTS -->
            <div class="col-lg-6">
                <form action="{{ url_for('aggiungi_prodotto_volantino', volantino_id=volantino['id']) }}" 
                      method="POST" enctype="multipart/form-data">

                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome Prodotto</label>
                        <input type="text" class="form-control" id="nome" name="nome" placeholder="Nome prodotto" required>
                    </div>

                    <div class="mb-3">
                        <label for="prezzo" class="form-label">Prezzo (â‚¬)</label>
                        <input type="number" step="0.01" min="0" class="form-control" id="prezzo" name="prezzo" placeholder="0.00" required>
                    </div>

                    <div class="mb-3">
                        <label for="immagine" class="form-label">Immagine Prodotto</label>
                        <input type="file" class="form-control" id="immagine" name="immagine" accept="image/*">
                        <div class="form-text">
                            Lâ€™immagine sarÃ  adattata alla cella (200Ã—230 px)
                        </div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success flex-grow-1">ðŸ’¾ Aggiungi Prodotto</button>
                        <a href="{{ url_for('modifica_volantino', volantino_id=volantino['id']) }}" class="btn btn-secondary flex-grow-1">â¬… Torna indietro</a>
                    </div>
                </form>
            </div>

            <!-- PREVIEW GRIGLIA -->
            <div class="col-lg-6">
                <h5 class="mb-3">Anteprima Volantino</h5>
                <div id="previewGrid" class="d-grid gap-3" style="grid-template-columns: repeat(3, 1fr);">
                    
                    {% for p in volantino_prodotti %}
                    <div class="border rounded-3 p-2 text-center" style="width:200px; height:230px; background:#fff;">
                        <img src="{{ url_for('static', filename='uploads/volantino_prodotti/' ~ p['immagine']) if p['immagine'] else 'https://via.placeholder.com/180x120?text=No+Image' }}"
                             style="max-width:180px; max-height:120px; object-fit:contain;" class="mb-2">
                        <div class="fw-semibold text-truncate" style="font-size:14px;">{{ p['nome'] }}</div>
                        <div class="text-danger fw-bold" style="font-size:18px;">â‚¬ {{ '%.2f'|format(p['prezzo']) if p['prezzo'] is not none else '0.00' }}</div>
                    </div>
                    {% endfor %}

                    <!-- CARD NUOVO PRODOTTO -->
                    <div id="newProductPreview" class="border rounded-3 p-2 text-center" style="width:200px; height:230px; background:#e9f7ff;">
                        <img id="previewImg" src="https://via.placeholder.com/180x120?text=Preview" 
                             style="max-width:180px; max-height:120px; object-fit:contain;" class="mb-2">
                        <div id="previewNome" class="fw-semibold text-truncate" style="font-size:14px;">Nome prodotto</div>
                        <div id="previewPrezzo" class="text-danger fw-bold" style="font-size:18px;">â‚¬ 0.00</div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const inputFile = document.getElementById("immagine");
    const inputNome = document.getElementById("nome");
    const inputPrezzo = document.getElementById("prezzo");

    const previewImg = document.getElementById("previewImg");
    const previewNome = document.getElementById("previewNome");
    const previewPrezzo = document.getElementById("previewPrezzo");

    inputFile.addEventListener("change", function() {
        const file = this.files[0];
        if(file){
            const reader = new FileReader();
            reader.onload = function(e){
                previewImg.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    inputNome.addEventListener("input", function() {
        previewNome.textContent = this.value || "Nome prodotto";
    });

    inputPrezzo.addEventListener("input", function() {
        const val = parseFloat(this.value);
        previewPrezzo.textContent = "â‚¬ " + (isNaN(val) ? "0.00" : val.toFixed(2));
    });
});
</script>

{% endblock %}
