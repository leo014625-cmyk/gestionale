{% extends "01_base.html" %}

{% block title %}Prodotti - Gestionale Horeca{% endblock %}

{% block content %}
<h1 class="mb-4">Gestione Prodotti</h1>

<div class="mb-4">
  <input type="text" id="searchGlobale" class="form-control form-control-lg" placeholder="Cerca prodotto o categoria...">
</div>

<!-- Pulsanti principali -->
<div class="mb-4 d-flex gap-2 flex-wrap">
  <a href="{{ url_for('aggiungi_prodotto') }}" class="btn btn-success">‚ûï Aggiungi Prodotto</a>
  <a href="{{ url_for('gestisci_categorie') }}" class="btn btn-secondary">üóÇÔ∏è Gestisci Categorie</a>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5" id="categorieCardContainer">
  {% if categorie %}
    {% for categoria in categorie %}
      {% set immagine = sfondi.get(categoria, 'no-image.png') %}
      {% set url_immagine = url_for('static', filename='uploads/categorie/' ~ immagine) %}
      <div class="col">
        <div class="card shadow-sm hover-scale cursor-pointer border-0 text-center position-relative categoria-card"
             style="background-image: url('{{ url_immagine }}');"
             data-bs-toggle="modal" 
             data-bs-target="#categoriaModal"
             data-categoria="{{ categoria }}">
          <div class="overlay d-flex flex-column justify-content-center align-items-center">
            <h5 class="card-title fw-bold">{{ categoria }}</h5>
            <p class="text-white">{{ prodotti_per_categoria.get(categoria, [])|length }} prodotti</p>
            <!-- DEBUG: mostra URL generato -->
            <small class="text-warning">DEBUG URL: {{ url_immagine }}</small>
          </div>
        </div>
        <!-- DEBUG: fallback immagine reale per controllare se il file esiste -->
        <img src="{{ url_immagine }}" alt="{{ categoria }}" style="max-width:100%; margin-top:0.5rem;">
      </div>
    {% endfor %}
  {% else %}
    <div class="col-12">
      <div class="alert alert-warning text-center">
        Nessuna categoria disponibile.
      </div>
    </div>
  {% endif %}
</div>

<div class="modal fade" id="categoriaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content modal-animate">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="categoriaModalLabel">Prodotti</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
      </div>
      <div class="modal-body p-0">
        <div class="search-container p-3 bg-light border-bottom sticky-top">
          <input type="text" id="searchProdotti" class="form-control" placeholder="Cerca prodotto in questa categoria...">
        </div>
        <div id="listaProdotti" class="list-group list-group-flush max-height-400 overflow-auto"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
      </div>
    </div>
  </div>
</div>

<a href="{{ url_for('index') }}" class="btn btn-secondary mt-5">üè† Torna alla home</a>
{% endblock %}
